- name: intall gui packages
  apt: pkg={{ item }} state=latest install_recommends=no
  with_items:
  - xserver-xorg-core
  - xserver-xorg-input-all
  # Basic universal video drivers
  - xserver-xorg-video-fbdev
  - xserver-xorg-video-vesa
  - xinit
  - lxde-core
  - lxde-common
  - lxde-icon-theme
  - lxsession
  - lxrandr
  - lxterminal
  - "{{ xorg_video_drivers }}"
- name: remove dependencies that are no longer required
  apt:
    autoremove: yes
- name: install additional gui packages
  apt: pkg={{ item }} state=latest
  with_items:
  - "{{ additional_gui_packages }}"
- name: add remmina and freerdp ppa repository
  apt_repository: repo="ppa:remmina-ppa-team/remmina-next"
  register: apt_repo_remmina
- name: update apt cache
  apt: update_cache=yes
  when: apt_repo_remmina is changed
- name: install freerdp
  apt: pkg={{ item }} state=latest install_recommends=no
  with_items:
    - freerdp-x11
# - name: remove unnecessary gui packages
#   apt: pkg={{ item }} state=absent purge=yes
#   with_items:
#     - gnome-screenshot
#     - xscreensaver
#     - xscreensaver-data
#     - lxtask
#     - x11-xserver-utils
#     - cpp
#     - cpp-5

- name: user bash_profile to autostart X session on first console
  template: src=template/home/bash_profile dest=/home/{{ autologin_user }}/.bash_profile owner=ubuntu mode=0640

  - name: user config directories
  file: path={{ item }} state=directory owner={{ autologin_user }}
  with_items:
    - /home/{{ autologin_user }}/.config
    - /home/{{ autologin_user }}/.config/autostart
    - /home/{{ autologin_user }}/.local
    - /home/{{ autologin_user }}/.local/bin

    - name: script to create RDP shortcuts
  template: src=template/home/local/bin/create-rdp-shortcuts.sh dest=/home/{{ autologin_user }}/.local/bin/create-rdp-shortcuts.sh owner=ubuntu mode=0755

  - name: autostart entry to create RDP shortcuts
  template: src=template/home/config/autostart/create-rdp-shortcuts.desktop dest=/home/{{ autologin_user }}/.config/autostart/create-rdp-shortcuts.desktop owner=ubuntu mode=0755
